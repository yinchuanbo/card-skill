---
title: "å‰ç«¯å†…å­˜æ³„æ¼ï¼šä½ çš„JSä»£ç åœ¨å·å·â€œåƒâ€å†…å­˜"
tags:
  - æ€§èƒ½
time: 2025-05-22 10:41:50
---

> â€œå†…å­˜æ³„æ¼ï¼Ÿæˆ‘çš„æµè§ˆå™¨é‚£ä¹ˆå¤šå†…å­˜ï¼Œç®¡ä»–å‘¢ï¼â€  
> â€œå“¥ï¼Œç­‰ä½ é¡µé¢æ‰“å¼€åŠå°æ—¶ï¼ŒChrome å¼€å§‹åƒæ‰ä½ æ‰€æœ‰çš„ RAMï¼Œä½ å°±çŸ¥é“æ€•äº†â€¦â€¦â€

ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼šä½ çš„ Web åº”ç”¨åœ¨åˆšå¯åŠ¨æ—¶è¿è¡Œæµç•…ï¼Œä½†ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå˜å¾—è¶Šæ¥è¶Šå¡ï¼Ÿä»»åŠ¡ç®¡ç†å™¨ä¸€æ‰“å¼€ï¼Œæµè§ˆå™¨å ç”¨çš„å†…å­˜é«˜å¾—ç¦»è°±ï¼Œå°±åƒä¸€å¤´æ— åº•æ´çš„é‡å…½ï¼Œåå™¬ç€ä½ çš„ RAMï¼Œç›´åˆ°ä½ çš„ç”µè„‘é£æ‰‡ç‹‚å¼ï¼Œæœ€åé¡µé¢ç›´æ¥å´©æºƒã€‚

æ­å–œï¼Œä½ é‡ä¸Šäº†å‰ç«¯å¼€å‘è€…çš„æ¢¦é­‡â€”â€”**å†…å­˜æ³„æ¼**ã€‚

---

## å•¥æ˜¯å‰ç«¯å†…å­˜æ³„æ¼ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸‹ï¼Œ**å†…å­˜ç®¡ç†çš„åŸºæœ¬åŸç†**ï¼š

1. **åˆ†é…å†…å­˜**ï¼šJavaScript åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦åˆ†é…å†…å­˜æ¥å­˜å‚¨å˜é‡ã€å¯¹è±¡ã€DOM å…ƒç´ ç­‰ã€‚
2. **ä½¿ç”¨å†…å­˜**ï¼šä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä¸æ–­åˆ›å»ºå’Œæ“ä½œè¿™äº›å˜é‡ã€‚
3. **é‡Šæ”¾å†…å­˜**ï¼šå½“å˜é‡ä¸å†è¢«å¼•ç”¨æ—¶ï¼ŒJS å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼ŒGarbage Collectorï¼‰ä¼šå›æ”¶è¿™äº›ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚

**é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼** å¦‚æœæŸäº›å˜é‡æˆ–å¯¹è±¡ä»ç„¶è¢«æ— æ„é—´å¼•ç”¨ï¼Œå³ä½¿å®ƒä»¬å·²ç»â€œæ²¡ç”¨äº†â€ï¼ŒGC ä¹Ÿæ— æ³•å›æ”¶å®ƒä»¬ï¼Œå¯¼è‡´å†…å­˜ä½¿ç”¨é‡ä¸æ–­å¢åŠ â€”â€”è¿™å°±æ˜¯**å†…å­˜æ³„æ¼**ï¼

### GC ä¸æ˜¯ä¸‡èƒ½çš„ï¼ŒJS çš„è®°å¿†åŠ›å¾ˆå·®

å¾ˆå¤šäººä»¥ä¸º JS çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å¸®ä½ æ¸…ç†æ‰€æœ‰æ— ç”¨çš„å†…å­˜ã€‚**å¤§é”™ç‰¹é”™ï¼** JS çš„åƒåœ¾å›æ”¶æ˜¯åŸºäº**å¼•ç”¨è®¡æ•°**å’Œ**å¯è¾¾æ€§åˆ†æ**æ¥å†³å®šå¯¹è±¡æ˜¯å¦åº”è¯¥è¢«å›æ”¶çš„ã€‚

- **å¼•ç”¨è®¡æ•°ï¼ˆReference Countingï¼‰** ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡ä»ç„¶è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå°±ä¸ä¼šè¢«å›æ”¶ã€‚
- **å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰** ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡ä»å…¨å±€ä½œç”¨åŸŸæˆ–å½“å‰æ‰§è¡Œçš„ä»£ç è·¯å¾„ä¸Šæ— æ³•è®¿é—®ï¼Œå®ƒæ‰ä¼šè¢«å›æ”¶ã€‚

æ‰€ä»¥ï¼Œåªè¦ä½ çš„ä»£ç é‡Œ**æ— æ„é—´**æ®‹ç•™äº†ä¸€äº›å¯¹æ— ç”¨å¯¹è±¡çš„å¼•ç”¨ï¼ŒGC å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚

---

## å¸¸è§çš„å‰ç«¯å†…å­˜æ³„æ¼åœºæ™¯ï¼ˆé™„çœŸå®æ¡ˆä¾‹ï¼‰

### 1\. å¿˜è®°æ¸…ç†å®šæ—¶å™¨ï¼ˆsetInterval / setTimeoutï¼‰

**æ€ä¼¤åŠ›æŒ‡æ•°ï¼šğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ**

**æ¡ˆä¾‹**ï¼š

```javascript
function startTimer() {
  setInterval(() => {
    console.log("Hello, å†…å­˜æ³„æ¼ï¼");
  }, 1000);
}
```

è¿™ä¸ª`setInterval`ä¼šä¸€ç›´æ‰§è¡Œï¼Œå“ªæ€•ä½ ç¦»å¼€è¿™ä¸ªé¡µé¢ï¼Œå®ƒä¹Ÿä¸ä¼šåœæ­¢ï¼Œå¯¼è‡´æ•´ä¸ªåº”ç”¨çš„å†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼š

```javascript
function startTimer() {
  const timerId = setInterval(() => {
    console.log("Hello, å†…å­˜æ³„æ¼ï¼");
  }, 1000);

  return () => clearInterval(timerId); // æä¾›ä¸€ä¸ªæ¸…ç†å‡½æ•°
}
```

åœ¨ç»„ä»¶é”€æ¯æ—¶ï¼ˆå¦‚`useEffect`çš„`cleanup`æˆ– Vue çš„`beforeDestroy`é’©å­ï¼‰ï¼Œæ‰‹åŠ¨æ¸…ç†å®šæ—¶å™¨ã€‚

---

### 2\. äº‹ä»¶ç›‘å¬å™¨æ²¡æœ‰è¢«ç§»é™¤

**æ€ä¼¤åŠ›æŒ‡æ•°ï¼šğŸŒŸğŸŒŸğŸŒŸğŸŒŸ**

**æ¡ˆä¾‹**ï¼š

```javascript
document.getElementById("btn").addEventListener("click", function () {
  console.log("æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼");
});
```

å¦‚æœè¿™ä¸ªæŒ‰é’®è¢«åŠ¨æ€åˆ é™¤ï¼Œäº‹ä»¶ç›‘å¬å™¨ä»ç„¶å­˜åœ¨ï¼Œå¹¶å¼•ç”¨äº†å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```javascript
const btn = document.getElementById("btn");

function handleClick() {
  console.log("æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼");
}

btn.addEventListener("click", handleClick);

// è®°å¾—åœ¨ä¸éœ€è¦æ—¶ç§»é™¤ç›‘å¬å™¨
btn.removeEventListener("click", handleClick);
```

åœ¨ Vue æˆ– React ä¸­ï¼Œåº”è¯¥åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œæ¯”å¦‚`useEffect`çš„`return`ï¼Œæˆ–è€… Vue çš„`beforeUnmount`é’©å­ã€‚

---

### 3\. ç»‘å®šåœ¨å…¨å±€å¯¹è±¡ï¼ˆwindow, documentï¼‰çš„å˜é‡

**æ€ä¼¤åŠ›æŒ‡æ•°ï¼šğŸŒŸğŸŒŸğŸŒŸğŸŒŸ**

**æ¡ˆä¾‹**ï¼š

```js
window.myData = new Array(1000000).fill("å å†…å­˜å•¦ï¼");
```

åªè¦`window.myData`å­˜åœ¨ï¼Œè¿™å—å·¨å¤§çš„æ•°ç»„æ°¸è¿œä¸ä¼šè¢« GC å›æ”¶ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼š

```js
window.myData = null; // æ‰‹åŠ¨é‡Šæ”¾å¼•ç”¨
```

æˆ–è€…ä½¿ç”¨`WeakMap`å­˜å‚¨ä¸éœ€è¦é•¿æ—¶é—´ä¿ç•™çš„æ•°æ®ï¼š

```javascript
const cache = new WeakMap();
const key = {};
cache.set(key, new Array(1000000).fill("ä¸ä¼šå¯¼è‡´æ³„æ¼"));
```

`WeakMap`ä¼šè‡ªåŠ¨é‡Šæ”¾æ²¡æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡ã€‚

---

### 4\. ç»„ä»¶æœªæ­£ç¡®é”€æ¯ï¼ˆReact/Vueï¼‰

**æ€ä¼¤åŠ›æŒ‡æ•°ï¼šğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ**

åœ¨å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œå¦‚æœç»„ä»¶å¸è½½åä»ç„¶æŒæœ‰çŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

**React æ¡ˆä¾‹**ï¼š

```javascript
useEffect(() => {
  const intervalId = setInterval(() => {
    console.log("è¿˜æ´»ç€ï¼");
  }, 1000);

  return () => clearInterval(intervalId); // è®°å¾—æ¸…ç†
}, []);
```

**Vue æ¡ˆä¾‹**ï¼š

```html
<script>
  export default {
    mounted() {
      this.intervalId = setInterval(() => {
        console.log("è¿˜æ´»ç€ï¼");
      }, 1000);
    },
    beforeDestroy() {
      clearInterval(this.intervalId); // è®°å¾—æ¸…ç†
    },
  };
</script>
```

ä½¿ç”¨ Vue3 Composition APIï¼š

```javascript
import { onMounted, onUnmounted } from "vue";

onMounted(() => {
  const timer = setInterval(() => {
    console.log("Hello Vue3!");
  }, 1000);

  onUnmounted(() => clearInterval(timer));
});
```

---

## å¦‚ä½•æ£€æµ‹å’Œä¿®å¤å‰ç«¯å†…å­˜æ³„æ¼ï¼Ÿ

### 1\. ä½¿ç”¨ Chrome DevTools çš„ Performance åˆ†æ

- **æ‰“å¼€ DevToolsï¼ˆF12ï¼‰**
- **Memory é¢æ¿**
- **ä½¿ç”¨ Heap Snapshot æ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡**
- **Timeline è§‚å¯Ÿå†…å­˜å ç”¨æ˜¯å¦æŒç»­å¢é•¿**

### 2\. é¿å…ä¸å¿…è¦çš„å…¨å±€å˜é‡

- **ä½¿ç”¨ `let` å’Œ `const` è€Œä¸æ˜¯ `var`**
- **å‡å°‘å¯¹ `window` çš„ç›´æ¥å¼•ç”¨**

### 3\. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

- **React/Vue ç»„ä»¶é”€æ¯æ—¶ï¼Œæ¸…ç†æ‰€æœ‰å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨**
- **ä½¿ç”¨ WeakMap é¿å…ä¸å¿…è¦çš„å¼ºå¼•ç”¨**
